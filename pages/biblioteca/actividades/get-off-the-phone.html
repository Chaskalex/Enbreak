<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enbreak | Get Off the Phone</title>
    <link rel="icon" type="image/x-icon" href="../../../favicon/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../favicon/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../favicon/apple-touch-icon.png">
    <link rel="manifest" href="../../../favicon/site.webmanifest">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/css/flag-icons.min.css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="../../../css/buttons.css">
    <script src="../../../js/audioplayer.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Rubik:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/style.css">
    <link rel="stylesheet" href="../../../css/activities.css">
    <style>
/* Hero Section */
.activity-hero {
    background: url('../../../assets/activities/getoff.jpg') center 30%/cover no-repeat;
}

.tab-nav-divider {
    display: none;
}

.tab-nav-secondary {
    display: flex;
    margin-left: auto;
    padding-right: 0;
}

.video-embed {
    margin: 0 auto 32px;
    border-radius: 12px;
    overflow: hidden;
    background: #000;
    aspect-ratio: 16/9;
    max-width: 720px;
}

.video-embed iframe {
    width: 100%;
    height: 100%;
    border: none;
}

/* Exercise Sections */
.exercise-section {
    position: relative;
}

.exercise-section .decorative-img {
    position: absolute;
    right: 0;
    top: 24px;
    width: 380px;
    height: auto;
    border-radius: 12px;
}

.exercise-section:last-child {
    margin-bottom: 0;
}

.exercise-step {
    padding: 6px 14px;
    border-radius: 8px;
    background: #ffedd5;
    border: 1px solid #fed7aa;
    color: #ea580c;
    font-family: 'Inter', sans-serif;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Reflection Questions */
.reflection-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.reflection-list li {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 14px 16px;
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: #374151;
    width: 100%;
    max-width: 500px;
}

.reflection-list li::before {
    content: '•';
    color: #ea580c;
    font-weight: bold;
    font-size: 20px;
    line-height: 1;
    margin-right: 8px;
    flex-shrink: 0;
}

/* Matching Exercise */
.matching-grid {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.matching-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background: #f9fafb;
    border-radius: 10px;
    border: 1px solid #e5e7eb;
}

.matching-image-placeholder {
    width: 60px;
    height: 60px;
    border-radius: 8px;
    background: #ffedd5;
    color: #ea580c;
    font-family: 'Rubik', sans-serif;
    font-size: 20px;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.matching-text {
    flex: 1;
    font-family: 'Inter', sans-serif;
    font-size: 15px;
    color: #374151;
}

.matching-input {
    width: 50px;
    height: 44px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    text-align: center;
    font-family: 'Inter', sans-serif;
    font-size: 16px;
    font-weight: 600;
    text-transform: uppercase;
    transition: all 0.2s;
}

.matching-input:focus {
    outline: none;
    border-color: #ea580c;
    box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.1);
}

.vocab-pool {
    background: #f9fafb;
    border: 2px dashed #e5e7eb;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 30px;
    transition: all 0.2s;
}

.vocab-pool.drag-over {
    border-color: #ea580c;
    background: #ffedd5;
    box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.1);
}

.vocab-pool-label {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: #374151;
    margin: 0 0 16px 0;
}

.vocab-words-container {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-content: flex-start;
}

.vocab-word {
    padding: 12px 16px;
    background: #ffffff;
    border: 2px solid #fed7aa;
    border-radius: 8px;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: #374151;
    cursor: grab;
    transition: all 0.2s;
    user-select: none;
    flex-grow: 0;
    flex-shrink: 0;
}

.vocab-word:hover {
    background: #ffedd5;
    border-color: #ea580c;
    box-shadow: 0 2px 8px rgba(234, 88, 12, 0.15);
}

.vocab-word.dragging {
    opacity: 0.5;
    cursor: grabbing;
}

.vocab-word strong {
    color: #ea580c;
    font-weight: 700;
}

.vocab-images-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
    margin-bottom: 16px;
}

.vocab-image-container {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.vocab-image-placeholder {
    width: 100%;
    aspect-ratio: 1;
    border-radius: 10px;
    background: #ffedd5;
    color: #ea580c;
    font-family: 'Rubik', sans-serif;
    font-size: 32px;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid #fed7aa;
    overflow: hidden;
    pointer-events: none;
}

.vocab-image-placeholder img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.vocab-drop-zone {
    min-height: 100px;
    border: 2px dashed #e5e7eb;
    border-radius: 8px;
    background: #fafafa;
    padding: 12px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.vocab-drop-zone.drag-over {
    border-color: #ea580c;
    background: #ffedd5;
    box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.1);
}

.vocab-drop-zone .dropped-word {
    padding: 10px 14px;
    background: #ffffff;
    border: 2px solid #fed7aa;
    border-radius: 6px;
    font-family: 'Inter', sans-serif;
    font-size: 13px;
    color: #374151;
    text-align: center;
    max-width: 100%;
    cursor: grab;
    transition: all 0.2s;
}

.vocab-drop-zone .dropped-word:active {
    cursor: grabbing;
}

.vocab-drop-zone .dropped-word.dragging {
    opacity: 0.5;
}

.vocab-drop-zone .dropped-word strong {
    color: #ea580c;
    font-weight: 700;
}

.vocab-drop-zone.correct-match {
    border-color: #86EFAC;
    background: #F0FDF4;
    color: #166534;
    box-shadow: 0 0 0 4px rgba(34,197,94,.08);
}

.vocab-drop-zone.incorrect-match {
    border-color: #FCA5A5;
    background: #FFF1F2;
    color: #9F1239;
    box-shadow: 0 0 0 4px rgba(239,68,68,.08);
}

/* Prediction Textareas */
.prediction-group {
    margin-bottom: 20px;
}

.prediction-group:last-child {
    margin-bottom: 0;
}

.prediction-label {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
    display: block;
}

.prediction-textarea {
    width: 100%;
    min-height: 80px;
    padding: 14px;
    border: 2px solid #e5e7eb;
    border-radius: 10px;
    font-family: 'Inter', sans-serif;
    font-size: 15px;
    color: #374151;
    resize: vertical;
    transition: all 0.2s;
}

.prediction-textarea:focus {
    outline: none;
    border-color: #ea580c;
    box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.1);
}

.prediction-textarea::placeholder {
    color: #9ca3af;
}

/* Prediction Checklist */
.prediction-checklist {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: fit-content;
}

.prediction-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 14px 16px;
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s;
}

.prediction-item:hover {
    background: #f3f4f6;
    border-color: #d1d5db;
}

.prediction-item.selected {
    background: #ffedd5;
    border-color: #fed7aa;
}

.prediction-item.correct {
    background: #F0FDF4;
    border-color: #86EFAC;
    color: #166534;
    box-shadow: 0 0 0 4px rgba(34,197,94,.08);
}

.prediction-item.incorrect {
    background: #FFF1F2;
    border-color: #FCA5A5;
    color: #9F1239;
    box-shadow: 0 0 0 4px rgba(239,68,68,.08);
}

.prediction-checkbox {
    width: 22px;
    height: 22px;
    border: 2px solid #d1d5db;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all 0.2s;
    margin-top: 1px;
}

.prediction-item.selected .prediction-checkbox {
    background: #ea580c;
    border-color: #ea580c;
    color: #ffffff;
}

.prediction-item.correct .prediction-checkbox {
    background: #166534;
    border-color: #166534;
    color: #ffffff;
}

.prediction-item.incorrect .prediction-checkbox {
    background: #9F1239;
    border-color: #9F1239;
    color: #ffffff;
}

.prediction-checkbox i {
    font-size: 12px;
    opacity: 0;
}

.prediction-item.selected .prediction-checkbox i,
.prediction-item.correct .prediction-checkbox i,
.prediction-item.incorrect .prediction-checkbox i {
    opacity: 1;
}

.prediction-text {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: #374151;
    line-height: 1.5;
}

.prediction-sentence {
    padding: 14px 16px;
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    margin-bottom: 12px;
}

.prediction-sentence:last-child {
    margin-bottom: 0;
}

.prediction-gap {
    min-width: 80px;
    display: inline-block;
}

/* True/False Exercise */
.tf-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.tf-item {
    padding: 14px 20px;
    background: #f9fafb;
    border-radius: 10px;
    border: 1px solid #e5e7eb;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
}

.tf-statement {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: #374151;
    margin-bottom: 0;
    flex: 1;
    line-height: 1.5;
}

.tf-buttons {
    display: flex;
    gap: 10px;
    flex-shrink: 0;
}

.tf-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    background: #ffffff;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 500;
    color: #6b7280;
    cursor: pointer;
    transition: all 0.2s;
}

.tf-btn:hover {
    border-color: #d1d5db;
}

.tf-btn.selected {
    background: #ffedd5;
    border-color: #fed7aa;
    color: #6b7280;
}

.tf-btn.correct {
    background: #F0FDF4;
    border-color: #86EFAC;
    color: #166534;
    box-shadow: 0 0 0 4px rgba(34,197,94,.08);
}

.tf-btn.incorrect {
    background: #FFF1F2;
    border-color: #FCA5A5;
    color: #9F1239;
    box-shadow: 0 0 0 4px rgba(239,68,68,.08);
}

/* Sentence Completion Exercise */
.sentence-completion-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.sentence-item {
    padding: 14px 20px;
    background: #f9fafb;
    border-radius: 10px;
    border: 1px solid #e5e7eb;
}

.sentence-text {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: #374151;
    margin: 0;
    line-height: 1.5;
    display: inline;
}

.sentence-dropdown {
    display: inline;
    width: auto;
    min-width: 150px;
    padding: 4px 8px;
    margin: 0 4px;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    background: #ffffff;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: #374151;
    cursor: pointer;
    transition: all 0.2s;
    vertical-align: baseline;
}

.sentence-dropdown:hover {
    border-color: #d1d5db;
}

.sentence-dropdown:focus {
    outline: none;
    border-color: #ea580c;
}

.sentence-dropdown.correct {
    border-color: #86EFAC;
    background: #F0FDF4;
    color: #166534;
    box-shadow: 0 0 0 4px rgba(34,197,94,.08);
    font-weight: 600;
}

.sentence-dropdown.incorrect {
    border-color: #FCA5A5;
    background: #FFF1F2;
    color: #9F1239;
    box-shadow: 0 0 0 4px rgba(239,68,68,.08);
    font-weight: 600;
}

/* Inline Choice Exercise */
.choice-group {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    margin: 0 6px;
    vertical-align: middle;
    background: #f3f4f6;
    padding: 4px;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
}

.choice-option {
    cursor: pointer;
    padding: 6px 12px;
    border-radius: 6px;
    color: #4b5563;
    font-weight: 600;
    font-size: 13px;
    border: 1px solid transparent;
    transition: all 0.2s;
    background: #ffffff;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    line-height: 1;
}

.choice-option:hover {
    border-color: #d1d5db;
    color: #1f2937;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.choice-option.selected {
    background: #ffedd5;
    color: #6b7280;
    border-color: #fed7aa;
    box-shadow: none;
}

.choice-option.correct {
    background: #16a34a;
    color: #ffffff;
    border-color: #16a34a;
    box-shadow: 0 2px 4px rgba(22, 163, 74, 0.25);
}

.choice-option.incorrect {
    background: #dc2626;
    color: #ffffff;
    border-color: #dc2626;
    box-shadow: 0 2px 4px rgba(220, 38, 38, 0.25);
}

/* Description Exercise */
.description-group {
    margin-bottom: 20px;
}

.description-group:last-child {
    margin-bottom: 0;
}

/* Matching Exercise */
.matching-container {
    position: relative;
    margin-bottom: 20px;
}

#matching-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 10;
}

.matching-exercise {
    position: relative;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    z-index: 1;
}

.matching-column {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.column-title {
    font-family: 'Inter', sans-serif;
    font-size: 16px;
    font-weight: 600;
    color: #1f2937;
    margin: 0 0 8px 0;
}

.matching-problems,
.matching-advice {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.matching-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 20px;
    background: #f9fafb;
    border-radius: 10px;
    border: 1px solid #e5e7eb;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
}

.matching-item:hover {
    background: #f3f4f6;
    border-color: #d1d5db;
}

.matching-item.selected {
    background: #ffedd5;
    border-color: #fed7aa;
}

.matching-item.matched {
    background: #e0f2fe;
    border-color: #0ea5e9;
    cursor: pointer;
}

.matching-item.matched:hover {
    background: #bae6fd;
    border-color: #0284c7;
}

.matching-item.correct {
    background: #F0FDF4;
    border-color: #86EFAC;
    color: #166534;
    box-shadow: 0 0 0 4px rgba(34,197,94,.08);
}

.matching-item.incorrect {
    background: #FFF1F2;
    border-color: #FCA5A5;
    color: #9F1239;
    box-shadow: 0 0 0 4px rgba(239,68,68,.08);
}

.matching-dot {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #d1d5db;
    border: 2px solid #ffffff;
    flex-shrink: 0;
    transition: all 0.2s;
}

.problem-item .matching-dot {
    order: 2;
}

.advice-item .matching-dot {
    order: -1;
}

.matching-item.selected .matching-dot {
    background: #ea580c;
    border-color: #ea580c;
}

.matching-item.matched .matching-dot {
    background: #0ea5e9;
    border-color: #0ea5e9;
}

.matching-item.correct .matching-dot {
    background: #166534;
    border-color: #166534;
}

.matching-item.incorrect .matching-dot {
    background: #9F1239;
    border-color: #9F1239;
}

.matching-item-content {
    flex: 1;
    display: flex;
    gap: 8px;
    align-items: flex-start;
}

.matching-number {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: #6b7280;
    flex-shrink: 0;
}

.matching-text {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: #374151;
    margin: 0;
    line-height: 1.5;
}

@media (max-width: 768px) {
    .matching-exercise {
        grid-template-columns: 1fr;
    }
}

/* Lyrics Tab */
.lyrics-container {
    max-width: 800px;
    margin: 0 auto;
}

.lyrics-header {
    text-align: center;
    margin-bottom: 32px;
}

.lyrics-header h3 {
    font-family: 'Rubik', sans-serif;
    font-size: 24px;
    font-weight: 600;
    color: #1f2937;
    margin: 0 0 8px 0;
}

.lyrics-header p {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: #6b7280;
}

.lyrics-box {
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 32px;
}

.lyrics-section {
    margin-bottom: 24px;
}

.lyrics-section:last-child {
    margin-bottom: 0;
}

.lyrics-section-title {
    font-family: 'Inter', sans-serif;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #ea580c;
    margin-bottom: 12px;
}

.lyrics-text {
    font-family: 'Inter', sans-serif;
    font-size: 15px;
    line-height: 1.8;
    color: #374151;
    white-space: pre-line;
}

/* Conversation Exercise - Two Column Layout */
.conversation-layout {
    display: grid;
    grid-template-columns: 1fr 180px;
    gap: 32px;
    margin: 30px 0 20px 0;
}

/* Left Column: Conversation Dialog */
.conversation-dialog-column {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.dialog-line {
    display: flex;
    gap: 12px;
    align-items: flex-start;
}

.dialog-avatar {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #e5e7eb;
    flex-shrink: 0;
}

.dialog-bubble {
    flex: 1;
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 14px 16px;
    position: relative;
}

.dialog-avatar-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    flex-shrink: 0;
}

.name-label {
    display: inline-block;
    font-family: 'Inter', sans-serif;
    font-size: 9px;
    font-weight: 700;
    padding: 3px 7px;
    border-radius: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.name-label-rhett {
    background: #dcfce7;
    color: #166534;
}

.name-label-link {
    background: #dbeafe;
    color: #1e40af;
}

.dialog-avatars-both {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    flex-shrink: 0;
}

.dialog-avatar-small {
    width: 44px;
    height: 44px;
}

.both-label {
    display: inline-block;
    font-family: 'Inter', sans-serif;
    font-size: 9px;
    font-weight: 700;
    color: #ea580c;
    background: #ffedd5;
    padding: 3px 7px;
    border-radius: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Audio Player */
.conversation-audio-player {
    width: 100%;
    max-width: 380px;
    margin: 20px auto 20px auto;
    display: block;
    outline: none;
}

.dialog-text {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    line-height: 1.7;
    color: #374151;
    margin: 0;
}

.conversation-gap {
    display: inline-flex;
    min-width: 100px;
    min-height: 30px;
    padding: 4px 8px;
    border: 2px dashed #e5e7eb;
    border-radius: 6px;
    background: #ffffff;
    vertical-align: middle;
    transition: all 0.2s;
    align-items: center;
    justify-content: center;
}

.conversation-gap.drag-over {
    border-color: #ea580c;
    background: #ffedd5;
    box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.1);
}

.conversation-gap .dropped-conversation-word {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: #ea580c;
    cursor: grab;
}

.conversation-gap.correct-gap {
    border-color: #86EFAC;
    background: #F0FDF4;
    color: #166534;
    box-shadow: 0 0 0 4px rgba(34,197,94,.08);
}

.conversation-gap.incorrect-gap {
    border-color: #FCA5A5;
    background: #FFF1F2;
    color: #9F1239;
    box-shadow: 0 0 0 4px rgba(239,68,68,.08);
}

/* Right Column: Vocabulary Word Bank */
.conversation-vocab-column {
    position: relative;
}

.vocab-pool-sticky {
    position: sticky;
    top: 20px;
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 16px;
}

.vocab-pool-sticky.drag-over {
    border-color: #ea580c;
    background: #ffedd5;
    box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.1);
}

.vocab-pool-sticky .vocab-words-container {
    display: flex;
    flex-direction: column;
    gap: 0;
}

.conversation-word {
    width: 100%;
    padding: 12px 16px;
    background: #ffffff;
    border: 2px solid #fed7aa;
    border-radius: 8px;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: #ea580c;
    cursor: grab;
    transition: all 0.2s;
    user-select: none;
    text-align: center;
    margin-bottom: 10px;
    box-sizing: border-box;
}

.conversation-word:last-child {
    margin-bottom: 0;
}

.conversation-word:hover {
    background: #ffedd5;
    border-color: #ea580c;
    box-shadow: 0 2px 8px rgba(234, 88, 12, 0.15);
    transform: translateY(-2px);
}

.conversation-word.dragging {
    opacity: 0.5;
    cursor: grabbing;
}

/* Responsive Design */
@media (max-width: 900px) {
    .conversation-layout {
        grid-template-columns: 1fr;
        gap: 24px;
    }

    .vocab-pool-sticky {
        position: static;
    }

    .tf-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
    }
    
    .tf-buttons {
        width: 100%;
        justify-content: flex-end;
    }
}

.lyrics-tip-box {
    margin-top: 24px;
}

/* Answer Feedback */
.matching-input.correct {
    border-color: #86EFAC;
    background: #F0FDF4;
    color: #166534;
    box-shadow: 0 0 0 4px rgba(34,197,94,.08);
}

.matching-input.incorrect {
    border-color: #FCA5A5;
    background: #FFF1F2;
    color: #9F1239;
    box-shadow: 0 0 0 4px rgba(239,68,68,.08);
}

.answer-feedback {
    margin-top: 16px;
    padding: 16px;
    border-radius: 10px;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    display: none;
}

.answer-feedback.show {
    display: flex;
    align-items: center;
    gap: 10px;
}

.answer-feedback.success {
    background: #F0FDF4;
    border: 1px solid #86EFAC;
    color: #166534;
    box-shadow: 0 0 0 4px rgba(34,197,94,.08);
}

.answer-feedback.partial {
    background: #fef9c3;
    border: 1px solid #fde047;
    color: #854d0e;
}

.answer-feedback.error {
    background: #FFF1F2;
    border: 1px solid #FCA5A5;
    color: #9F1239;
    box-shadow: 0 0 0 4px rgba(239,68,68,.08);
}

/* Results Tab */
.results-header {
    text-align: center;
    margin-bottom: 40px;
}

.results-header h3 {
    font-family: 'Rubik', sans-serif;
    font-size: 28px;
    font-weight: 700;
    color: #1f2937;
    margin: 0 0 8px 0;
}

.results-header p {
    font-family: 'Inter', sans-serif;
    font-size: 15px;
    color: #6b7280;
}

.results-score-card {
    background: linear-gradient(135deg, #0a1e42 0%, #1e3a5f 100%);
    border-radius: 16px;
    padding: 32px;
    text-align: center;
    margin-bottom: 40px;
}

.results-score-circle {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    border: 4px solid #ea580c;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
}

.results-score-number {
    font-family: 'Rubik', sans-serif;
    font-size: 36px;
    font-weight: 700;
    color: #ffffff;
}

.results-score-label {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: rgba(255, 255, 255, 0.7);
}

.results-section {
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
}

.results-section:last-child {
    margin-bottom: 0;
}

.results-section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
}

.results-section-title {
    font-family: 'Rubik', sans-serif;
    font-size: 18px;
    font-weight: 600;
    color: #1f2937;
    display: flex;
    align-items: center;
    gap: 10px;
}

.results-section-score {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 600;
    padding: 6px 14px;
    border-radius: 20px;
}

.results-section-score.good {
    background: #dcfce7;
    color: #166534;
}

.results-section-score.medium {
    background: #fef9c3;
    color: #854d0e;
}

.results-section-score.poor {
    background: #fee2e2;
    color: #991b1b;
}

.results-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 14px;
    background: #ffffff;
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1px solid #e5e7eb;
}

.results-item:last-child {
    margin-bottom: 0;
}

.results-item-icon {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    flex-shrink: 0;
}

.results-item-icon.correct {
    background: #F0FDF4;
    color: #16a34a;
    border: 1px solid #86EFAC;
}

.results-item-icon.incorrect {
    background: #FFF1F2;
    color: #9F1239;
    border: 1px solid #FCA5A5;
}

.results-item-content {
    flex: 1;
}

.results-item-question {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: #374151;
    margin-bottom: 4px;
}

.results-item-answer {
    font-family: 'Inter', sans-serif;
    font-size: 13px;
}

.results-item-answer.user-answer {
    color: #6b7280;
}

.results-item-answer.correct-answer {
    color: #166534;
    font-weight: 500;
}

/* Responsive */
@media (max-width: 900px) {
    .intro-grid {
        grid-template-columns: 1fr;
    }

    .exercise-section .decorative-img {
        position: static;
        width: 100%;
        height: auto;
        margin-bottom: 24px;
    }
}

@media (max-width: 768px) {
    .tab-nav-divider {
        display: none;
    }

    .tab-nav-secondary {
        width: 100%;
        padding: 8px;
        border-top: 1px solid #e5e7eb;
        background: #f3f4f6;
    }
}
    </style>
    <script>
        const activityConfig = {
            type: 'listening',
            tabs: ['introduction', 'pre-listening', 'listening', 'post-listening', 'lyrics'],
            hiddenTab: 'lyrics'
        };
    </script>
    <script src="../../../js/tabs.js"></script>
</head>
<body>

    <div id="header-placeholder"></div>

    <main class="activity-page">
        <!-- Hero Section -->
        <section class="activity-hero">
            <div class="activity-hero-content">
                <nav class="breadcrumb">
                    <a href="/">Inicio</a>
                    <span class="breadcrumb-separator">›</span>
                    <a href="../actividades.html">Actividades</a>
                    <span class="breadcrumb-separator">›</span>
                    <span class="breadcrumb-current">Get Off the Phone</span>
                </nav>
                <h1>Get Off the Phone</h1>
                <div class="activity-hero-badges">
                    <span class="hero-badge"><i class="fa-solid fa-headphones"></i> Listening</span>
                    <span class="hero-badge"><i class="fa-solid fa-layer-group"></i> Level B1</span>
                    <span class="hero-badge"><i class="fa-regular fa-clock"></i> 30 min</span>
                </div>
            </div>
        </section>

        <!-- Activity Content -->
        <section class="activity-container">
            <div class="tabs-wrapper">
                <!-- Tab Navigation -->
                <nav class="tab-nav">
                    <div class="tab-nav-main">
                        <button class="tab-btn active" data-tab="introduction">Introduction</button>
                        <button class="tab-btn" data-tab="pre-listening">Pre-Listening</button>
                        <button class="tab-btn" data-tab="listening">Listening</button>
                        <button class="tab-btn" data-tab="post-listening">Post-Listening</button>
                        <button class="tab-btn" data-tab="lyrics">View Lyrics</button>
                    </div>
                </nav>

                <!-- Introduction Tab -->
                <div class="tab-content active" id="introduction">
                    <div class="intro-grid">
                        <div class="intro-main">
                            <p class="intro-text">
                                Did you know the average person spends over 4 hours a day on their phone? That's nearly 60 days a year staring at a screen. In a world where notifications never stop, knowing how to talk about <strong>technology habits</strong> is more relevant than ever.
                            </p>
                            <p class="intro-text">
                                In this activity, you will practise listening comprehension through a catchy song about <strong>phone addiction</strong>. You will work on understanding <strong>natural spoken language</strong>, picking up vocabulary related to technology and everyday habits, and following meaning even when the language moves fast.
                            </p>
                            <p class="intro-text">
                                By the end, you will be able to understand the song's message, discuss technology habits, and give advice on difficult situations related to phone use.
                            </p>
                        </div>
                        <div class="intro-sidebar">
                            <div class="info-card">
                                <div class="info-card-icon">
                                    <i class="fa-solid fa-bullseye"></i>
                                </div>
                                <div class="info-card-content">
                                    <h4>Learning Objective</h4>
                                    <p>You will be able to provide advice on difficult situations related to technology.</p>
                                </div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-icon">
                                    <i class="fa-solid fa-headphones"></i>
                                </div>
                                <div class="info-card-content">
                                    <h4>Skill Focus</h4>
                                    <p>Listening Comprehension (B1 Level)</p>
                                </div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-icon">
                                    <i class="fa-brands fa-youtube"></i>
                                </div>
                                <div class="info-card-content">
                                    <h4>Source</h4>
                                    <p>Get Off The Phone by Rhett & Link</p>
                                    <a href="https://youtu.be/nfUD0WhE264" target="_blank" rel="noopener noreferrer" style="color: #2563eb; font-size: 13px; text-decoration: none;">Watch on YouTube <i class="fa-solid fa-external-link" style="font-size: 11px;"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pre-Listening Tab -->
                <div class="tab-content" id="pre-listening">
                    <!-- Step 1: Reflection -->
                    <div class="exercise-section">
                        <img src="../../../assets/activities/get-off-the-phone/phone-habits.jpg" alt="Person using phone" class="decorative-img">
                        <div class="exercise-header">
                            <span class="exercise-number">1</span>
                            <h3>Your phone habits</h3>
                        </div>
                        <p class="exercise-instructions">Before we start, think about how you use your phone. Reflect on these questions:</p>
                        <ul class="reflection-list">
                            <li>Do you usually take pictures of your food before eating?</li>
                            <li>Do you record videos at concerts, parties, or special events?</li>
                            <li>Do you check your phone while eating with friends or family?</li>
                        </ul>
                    </div>

                    <!-- Step 2: Complete the Conversation -->
                    <div class="exercise-section">
                        <div class="exercise-header">
                            <span class="exercise-number">2</span>
                            <h3>Phone use conversation</h3>
                        </div>
                        <p class="exercise-instructions">Rhett and Link are having a conversation about phones. Listen and complete the missing gaps with the words from the box.</p>

                        <div id="conversation-player-container" style="width: 100%; max-width: 520px; margin: 0 auto 24px auto;"></div>

                        <!-- Two Column Layout -->
                        <div class="conversation-layout">
                            <!-- Left Column: Conversation Dialog -->
                            <div class="conversation-dialog-column">
                                <div class="dialog-line">
                                    <div class="dialog-avatar-wrapper">
                                        <img src="../../../assets/activities/get-off-the-phone/rhett.jpg" alt="Rhett" class="dialog-avatar">
                                        <span class="name-label name-label-rhett">Rhett</span>
                                    </div>
                                    <div class="dialog-bubble">
                                        <p class="dialog-text">"Hey man, I've recently been doing some <span class="conversation-gap" data-word-id="contemplation"></span> about people's <span class="conversation-gap" data-word-id="dependency"></span> upon cellular telephones"</p>
                                    </div>
                                </div>
                                <div class="dialog-line">
                                    <div class="dialog-avatar-wrapper">
                                        <img src="../../../assets/activities/get-off-the-phone/link.jpg" alt="Link" class="dialog-avatar">
                                        <span class="name-label name-label-link">Link</span>
                                    </div>
                                    <div class="dialog-bubble">
                                        <p class="dialog-text">"Yeah man, me too. I've really <span class="conversation-gap" data-word-id="noticed"></span> that everyone always seems to be on their mobile device <span class="conversation-gap" data-word-id="instead"></span> of really being in the moment."</p>
                                    </div>
                                </div>
                                <div class="dialog-line">
                                    <div class="dialog-avatar-wrapper">
                                        <img src="../../../assets/activities/get-off-the-phone/rhett.jpg" alt="Rhett" class="dialog-avatar">
                                        <span class="name-label name-label-rhett">Rhett</span>
                                    </div>
                                    <div class="dialog-bubble">
                                        <p class="dialog-text">"Exactly, and I feel like this is a very significant <span class="conversation-gap" data-word-id="issue"></span> that needs to be <span class="conversation-gap" data-word-id="addressed"></span> immediately."</p>
                                    </div>
                                </div>
                                <div class="dialog-line">
                                    <div class="dialog-avatar-wrapper">
                                        <img src="../../../assets/activities/get-off-the-phone/link.jpg" alt="Link" class="dialog-avatar">
                                        <span class="name-label name-label-link">Link</span>
                                    </div>
                                    <div class="dialog-bubble">
                                        <p class="dialog-text">"Yes, immediately."</p>
                                    </div>
                                </div>
                                <div class="dialog-line">
                                    <div class="dialog-avatars-both">
                                        <img src="../../../assets/activities/get-off-the-phone/rhett.jpg" alt="Rhett" class="dialog-avatar dialog-avatar-small">
                                        <img src="../../../assets/activities/get-off-the-phone/link.jpg" alt="Link" class="dialog-avatar dialog-avatar-small">
                                        <span class="both-label">BOTH</span>
                                    </div>
                                    <div class="dialog-bubble">
                                        <p class="dialog-text">"We really <span class="conversation-gap" data-word-id="should"></span> do something about this."</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Right Column: Vocabulary Word Bank -->
                            <div class="conversation-vocab-column">
                                <div class="vocab-pool-sticky" id="conversation-vocab-pool">
                                    <div class="vocab-words-container" id="conversation-words-container">
                                        <div class="conversation-word" draggable="true" data-word-id="noticed">noticed</div>
                                        <div class="conversation-word" draggable="true" data-word-id="should">should</div>
                                        <div class="conversation-word" draggable="true" data-word-id="dependency">dependency</div>
                                        <div class="conversation-word" draggable="true" data-word-id="addressed">addressed</div>
                                        <div class="conversation-word" draggable="true" data-word-id="contemplation">contemplation</div>
                                        <div class="conversation-word" draggable="true" data-word-id="instead">instead</div>
                                        <div class="conversation-word" draggable="true" data-word-id="issue">issue</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px; align-items: center;">
                            <button class="check-answers-btn" id="check-conversation">
                                <i class="fa-solid fa-check"></i> Check answers
                            </button>
                            <button class="check-answers-btn retry-btn" id="retry-conversation" disabled>
                                <i class="fa-solid fa-rotate-right"></i> Try again
                            </button>
                        </div>
                        <div class="answer-feedback" id="conversation-feedback"></div>
                    </div>

                    <!-- Step 3: Make Predictions -->
                    <div class="exercise-section">
                        <div class="exercise-header">
                            <span class="exercise-number">3</span>
                            <h3>Making predictions</h3>
                        </div>
                        <p class="exercise-instructions">Based on the conversation, which of the following predictions seem accurate? More than one answer may be correct.</p>
                        
                        <div class="prediction-checklist" id="prediction-checklist">
                            <div class="prediction-item" data-correct="true">
                                <div class="prediction-checkbox"><i class="fa-solid fa-check"></i></div>
                                <span class="prediction-text">The song will criticize people for using phones during meals.</span>
                            </div>
                            <div class="prediction-item" data-correct="false">
                                <div class="prediction-checkbox"><i class="fa-solid fa-check"></i></div>
                                <span class="prediction-text">They will drive off to another city where phones are prohibited.</span>
                            </div>
                            <div class="prediction-item" data-correct="true">
                                <div class="prediction-checkbox"><i class="fa-solid fa-check"></i></div>
                                <span class="prediction-text">They will persuade people to stop using their phones.</span>
                            </div>
                            <div class="prediction-item" data-correct="false">
                                <div class="prediction-checkbox"><i class="fa-solid fa-check"></i></div>
                                <span class="prediction-text">The song will be about the benefits of social media.</span>
                            </div>
                            <div class="prediction-item" data-correct="true">
                                <div class="prediction-checkbox"><i class="fa-solid fa-check"></i></div>
                                <span class="prediction-text">They will show people glued to their phones instead of connecting with each other.</span>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px; align-items: center; margin-top: 20px;">
                            <button class="check-answers-btn" id="check-predictions">
                                <i class="fa-solid fa-check"></i> Check answers
                            </button>
                            <button class="check-answers-btn retry-btn" id="retry-predictions" disabled>
                                <i class="fa-solid fa-rotate-right"></i> Try again
                            </button>
                        </div>
                        <div class="answer-feedback" id="prediction-feedback"></div>
                    </div>

                    <!-- Step 4: Vocabulary Matching -->
                    <div class="exercise-section">
                        <div class="exercise-header">
                            <span class="exercise-number">4</span>
                            <h3>Matching vocabulary</h3>
                        </div>
                        <p class="exercise-instructions">Match the phrases to the images. Drag and drop each phrase under the picture that best describes it.</p>
                        
                        <!-- Vocabulary Words Pool -->
                        <div class="vocab-pool" id="vocab-pool">
                            <div class="vocab-words-container" id="vocab-words-container">
                                <div class="vocab-word" draggable="true" data-image-id="image-2">
                                    "His apple pie <strong>à la mode</strong>"
                                </div>
                                <div class="vocab-word" draggable="true" data-image-id="image-3">
                                    "The <strong>street performer</strong>"
                                </div>
                                <div class="vocab-word" draggable="true" data-image-id="image-4">
                                    "A <strong>crowd</strong> to watch him do his thing"
                                </div>
                                <div class="vocab-word" draggable="true" data-image-id="image-5">
                                    "This unreasonably attractive <strong>couple</strong>"
                                </div>
                                <div class="vocab-word" draggable="true" data-image-id="image-6">
                                    "As he fumbles through the <strong>filters</strong>"
                                </div>
                                <div class="vocab-word" draggable="true" data-image-id="image-8">
                                    "More worried about <strong>facebooking</strong> it"
                                </div>
                            </div>
                        </div>

                        <!-- Images Grid with Drop Zones (shuffled) -->
                        <div class="vocab-images-grid">
                            <div class="vocab-image-container">
                                <div class="vocab-image-placeholder">
                                    <img src="../../../assets/activities/get-off-the-phone/crowd.jpg" alt="Crowd">
                                </div>
                                <div class="vocab-drop-zone" data-image-id="image-4"></div>
                            </div>
                            <div class="vocab-image-container">
                                <div class="vocab-image-placeholder">
                                    <img src="../../../assets/activities/get-off-the-phone/apple-pie.jpg" alt="Apple pie à la mode">
                                </div>
                                <div class="vocab-drop-zone" data-image-id="image-2"></div>
                            </div>
                            <div class="vocab-image-container">
                                <div class="vocab-image-placeholder">
                                    <img src="../../../assets/activities/get-off-the-phone/facebooking-it.jpg" alt="Facebooking it">
                                </div>
                                <div class="vocab-drop-zone" data-image-id="image-8"></div>
                            </div>
                            <div class="vocab-image-container">
                                <div class="vocab-image-placeholder">
                                    <img src="../../../assets/activities/get-off-the-phone/street-performer.jpg" alt="Street performer">
                                </div>
                                <div class="vocab-drop-zone" data-image-id="image-3"></div>
                            </div>
                            <div class="vocab-image-container">
                                <div class="vocab-image-placeholder">
                                    <img src="../../../assets/activities/get-off-the-phone/attractive-couple.jpg" alt="Attractive couple">
                                </div>
                                <div class="vocab-drop-zone" data-image-id="image-5"></div>
                            </div>
                            <div class="vocab-image-container">
                                <div class="vocab-image-placeholder">
                                    <img src="../../../assets/activities/get-off-the-phone/phone.jpg" alt="Get off the phone">
                                </div>
                                <div class="vocab-drop-zone" data-image-id="image-6"></div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px; align-items: center;">
                            <button class="check-answers-btn" id="check-vocab-matching">
                                <i class="fa-solid fa-check"></i> Check answers
                            </button>
                            <button class="check-answers-btn retry-btn" id="retry-vocab-matching" disabled>
                                <i class="fa-solid fa-rotate-right"></i> Try again
                            </button>
                        </div>
                        <div class="answer-feedback" id="vocab-matching-feedback"></div>
                    </div>
                </div>

                <!-- Listening Tab -->
                <div class="tab-content" id="listening">

                    <!-- Exercise 1: Listening Only - Main Idea -->
                    <div class="exercise-section">
                        <div class="exercise-header">
                            <span class="exercise-number">5</span>
                            <h3>Getting the Main Idea</h3>
                        </div>
                        <p class="exercise-instructions">Listen to the song for the first time. Choose the alternative that best describes the main idea of the song.</p>
                        
                        <div class="video-embed">
                            <iframe
                                src="https://www.youtube.com/embed/nfUD0WhE264"
                                title="Get Off the Phone - Rhett & Link"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                allowfullscreen>
                            </iframe>
                        </div>
                        
                        <div class="prediction-checklist" id="main-idea-checklist">
                            <div class="prediction-item" data-correct="false">
                                <div class="prediction-checkbox"><i class="fa-solid fa-check"></i></div>
                                <span class="prediction-text">The song warns that spending too much time on phones is making people forget important skills and knowledge.</span>
                            </div>
                            <div class="prediction-item" data-correct="true">
                                <div class="prediction-checkbox"><i class="fa-solid fa-check"></i></div>
                                <span class="prediction-text">The song criticizes people's obsession with their phones, which causes them to miss real-life experiences.</span>
                            </div>
                            <div class="prediction-item" data-correct="false">
                                <div class="prediction-checkbox"><i class="fa-solid fa-check"></i></div>
                                <span class="prediction-text">The song argues that phones are dangerous because the government uses them to spy on and control people.</span>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px; align-items: center; margin-top: 20px;">
                            <button class="check-answers-btn" id="check-main-idea">
                                <i class="fa-solid fa-check"></i> Check answer
                            </button>
                            <button class="check-answers-btn retry-btn" id="retry-main-idea" disabled>
                                <i class="fa-solid fa-rotate-right"></i> Try again
                            </button>
                        </div>
                    </div>

                    <!-- Exercise 2: True or False -->
                    <div class="exercise-section">
                        <div class="exercise-header">
                            <span class="exercise-number">6</span>
                            <h3>True or False</h3>
                        </div>
                        <p class="exercise-instructions">Listen again and decide if the following statements are True or False.</p>
                        <div class="tf-list" id="tf-list">
                            <div class="tf-item" data-correct="true">
                                <p class="tf-statement">1. The man's dessert was ruined because he spent too much time choosing filters for his photo.</p>
                                <div class="tf-buttons">
                                    <button class="tf-btn" data-value="true">True</button>
                                    <button class="tf-btn" data-value="false">False</button>
                                </div>
                            </div>
                            <div class="tf-item" data-correct="false">
                                <p class="tf-statement">2. The crowd watching the street performer decided to put their phones away and enjoy the show.</p>
                                <div class="tf-buttons">
                                    <button class="tf-btn" data-value="true">True</button>
                                    <button class="tf-btn" data-value="false">False</button>
                                </div>
                            </div>
                            <div class="tf-item" data-correct="true">
                                <p class="tf-statement">3. The unreasonably attractive couple at the restaurant turned out to be siblings.</p>
                                <div class="tf-buttons">
                                    <button class="tf-btn" data-value="true">True</button>
                                    <button class="tf-btn" data-value="false">False</button>
                                </div>
                            </div>
                            <div class="tf-item" data-correct="false">
                                <p class="tf-statement">4. The stereotypical teen is excited to be part of family game night.</p>
                                <div class="tf-buttons">
                                    <button class="tf-btn" data-value="true">True</button>
                                    <button class="tf-btn" data-value="false">False</button>
                                </div>
                            </div>
                            <div class="tf-item" data-correct="false">
                                <p class="tf-statement">5. The baby's father prefers spending time with his son rather than posting him on social media.</p>
                                <div class="tf-buttons">
                                    <button class="tf-btn" data-value="true">True</button>
                                    <button class="tf-btn" data-value="false">False</button>
                                </div>
                            </div>
                            <div class="tf-item" data-correct="true">
                                <p class="tf-statement">6. The man eating a hotdog actually needed to use his phone to call for emergency assistance.</p>
                                <div class="tf-buttons">
                                    <button class="tf-btn" data-value="true">True</button>
                                    <button class="tf-btn" data-value="false">False</button>
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px; align-items: center; margin-top: 20px;">
                            <button class="check-answers-btn" id="check-tf">
                                <i class="fa-solid fa-check"></i> Check answers
                            </button>
                            <button class="check-answers-btn retry-btn" id="retry-tf" disabled>
                                <i class="fa-solid fa-rotate-right"></i> Try again
                            </button>
                        </div>
                    </div>

                    <!-- Exercise 3: Complete the Sentences -->
                    <div class="exercise-section">
                        <div class="exercise-header">
                            <span class="exercise-number">7</span>
                            <h3>Complete the Sentences</h3>
                        </div>
                        <p class="exercise-instructions">Watch the video carefully and complete the sentences. Choose between Past Simple, Past Continuous, and their negative forms. The video context will help you decide!</p>
                        <div class="sentence-completion-list" id="sentence-completion-list">
                            <div class="sentence-item">
                                <p class="sentence-text">1. The man
                                    <span class="choice-group" data-correct="didn't eat">
                                        <span class="choice-option">didn't eat</span> <span class="choice-option">was eating</span>
                                    </span>
                                    his dessert because he
                                    <span class="choice-group" data-correct="fumbled">
                                        <span class="choice-option">was fumbling</span> <span class="choice-option">fumbled</span>
                                    </span>
                                    through Instagram filters first.
                                </p>
                            </div>
                            <div class="sentence-item">
                                <p class="sentence-text">2. Everyone
                                    <span class="choice-group" data-correct="decided">
                                        <span class="choice-option">decided</span> <span class="choice-option">were deciding</span>
                                    </span>
                                    to make a documentary of the street performer, so they
                                    <span class="choice-group" data-correct="were filming">
                                        <span class="choice-option">filmed</span> <span class="choice-option">were filming</span>
                                    </span>
                                    instead of enjoying the show directly.
                                </p>
                            </div>
                            <div class="sentence-item">
                                <p class="sentence-text">3. The couple
                                    <span class="choice-group" data-correct="were">
                                        <span class="choice-option">were</span> <span class="choice-option">weren't</span>
                                    </span>
                                    at an Italian restaurant together, but they
                                    <span class="choice-group" data-correct="didn't touch">
                                        <span class="choice-option">touched</span> <span class="choice-option">didn't touch</span>
                                    </span>
                                    each other—they only touched their phones.
                                </p>
                            </div>
                            <div class="sentence-item">
                                <p class="sentence-text">4. The mother
                                    <span class="choice-group" data-correct="demonstrated">
                                        <span class="choice-option">demonstrated</span> <span class="choice-option">was demonstrating</span>
                                    </span>
                                    a carousel ride, but her son
                                    <span class="choice-group" data-correct="didn't pay">
                                        <span class="choice-option">paid</span> <span class="choice-option">didn't pay</span>
                                    </span>
                                    attention because he was texting.
                                </p>
                            </div>
                            <div class="sentence-item">
                                <p class="sentence-text">5. The dad
                                    <span class="choice-group" data-correct="didn't play">
                                        <span class="choice-option">played</span> <span class="choice-option">didn't play</span>
                                    </span>
                                    with baby Ethan because he
                                    <span class="choice-group" data-correct="posted">
                                        <span class="choice-option">posted</span> <span class="choice-option">was posting</span>
                                    </span>
                                    pictures to Facebook instead.
                                </p>
                            </div>
                            <div class="sentence-item">
                                <p class="sentence-text">6. When the hotdog man
                                    <span class="choice-group" data-correct="made">
                                        <span class="choice-option">made</span> <span class="choice-option">was making</span>
                                    </span>
                                    an emergency call, the singers
                                    <span class="choice-group" data-correct="thought">
                                        <span class="choice-option">thought</span> <span class="choice-option">were thinking</span>
                                    </span>
                                    he was being disrespectful.
                                </p>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px; align-items: center;">
                            <button class="check-answers-btn" id="check-sentences">
                                <i class="fa-solid fa-check"></i> Check answers
                            </button>
                            <button class="check-answers-btn retry-btn" id="retry-sentences" disabled>
                                <i class="fa-solid fa-rotate-right"></i> Try again
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Post-Listening Tab -->
                <div class="tab-content" id="post-listening">
                    <!-- Exercise 4: Giving Advice -->
                    <div class="exercise-section">
                        <div class="exercise-header">
                            <span class="exercise-number">8</span>
                            <h3>Giving Advice</h3>
                        </div>
                        <p class="exercise-instructions">Read each problem and match it with the most appropriate advice.</p>

                        <div class="matching-container">
                            <canvas id="matching-canvas"></canvas>
                            <div class="matching-exercise">
                                <div class="matching-column">
                                    <h4 class="column-title">Problems</h4>
                                    <div class="matching-problems" id="matching-problems">
                                        <div class="matching-item problem-item" data-id="1" data-correct="3">
                                            <div class="matching-dot"></div>
                                            <div class="matching-item-content">
                                                <span class="matching-number">1.</span>
                                                <p class="matching-text">My phone always dies before noon because I can't stop scrolling through apps.</p>
                                            </div>
                                        </div>
                                        <div class="matching-item problem-item" data-id="2" data-correct="1">
                                            <div class="matching-dot"></div>
                                            <div class="matching-item-content">
                                                <span class="matching-number">2.</span>
                                                <p class="matching-text">I record every concert I attend but never actually enjoy the live performance.</p>
                                            </div>
                                        </div>
                                        <div class="matching-item problem-item" data-id="3" data-correct="5">
                                            <div class="matching-dot"></div>
                                            <div class="matching-item-content">
                                                <span class="matching-number">3.</span>
                                                <p class="matching-text">I feel like I ignore my partner during dates because I'm always on my phone.</p>
                                            </div>
                                        </div>
                                        <div class="matching-item problem-item" data-id="4" data-correct="2">
                                            <div class="matching-dot"></div>
                                            <div class="matching-item-content">
                                                <span class="matching-number">4.</span>
                                                <p class="matching-text">I suffer from constant neck pain after spending hours hunched over my phone.</p>
                                            </div>
                                        </div>
                                        <div class="matching-item problem-item" data-id="5" data-correct="4">
                                            <div class="matching-dot"></div>
                                            <div class="matching-item-content">
                                                <span class="matching-number">5.</span>
                                                <p class="matching-text">I'm always running late because I lose track of time on social media before leaving.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="matching-column">
                                    <h4 class="column-title">Advice</h4>
                                    <div class="matching-advice">
                                        <div class="matching-item advice-item" data-id="1">
                                            <div class="matching-item-content">
                                                <p class="matching-text">You should put your phone away at concerts and enjoy the live experience instead of filming.</p>
                                            </div>
                                            <div class="matching-dot"></div>
                                        </div>
                                        <div class="matching-item advice-item" data-id="2">
                                            <div class="matching-item-content">
                                                <p class="matching-text">You should hold your phone at eye level to prevent neck strain.</p>
                                            </div>
                                            <div class="matching-dot"></div>
                                        </div>
                                        <div class="matching-item advice-item" data-id="3">
                                            <div class="matching-item-content">
                                                <p class="matching-text">You should carry a portable charger or limit your daily screen time.</p>
                                            </div>
                                            <div class="matching-dot"></div>
                                        </div>
                                        <div class="matching-item advice-item" data-id="4">
                                            <div class="matching-item-content">
                                                <p class="matching-text">You should set reminders 15 minutes before leaving to stay on schedule.</p>
                                            </div>
                                            <div class="matching-dot"></div>
                                        </div>
                                        <div class="matching-item advice-item" data-id="5">
                                            <div class="matching-item-content">
                                                <p class="matching-text">You should keep your phone away during meals and focus on your partner.</p>
                                            </div>
                                            <div class="matching-dot"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px; align-items: center;">
                            <button class="check-answers-btn" id="check-matching">
                                <i class="fa-solid fa-circle-check"></i> Check answers
                            </button>
                            <button class="check-answers-btn retry-btn" id="retry-matching" disabled>
                                <i class="fa-solid fa-rotate-right"></i> Try again
                            </button>
                        </div>
                    </div>

                    <div class="completion-box">
                        <div class="completion-bar"></div>
                        <div class="completion-inner">
                            <div class="completion-header">
                                <div class="completion-icon">
                                    <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                                </div>
                                <h2 class="completion-title">Activity Complete!</h2>
                            </div>
                            <p class="completion-subtitle">You've completed <strong>"Get Off the Phone"</strong>. Here's what you've practised:</p>
                            <div class="skills-list">
                                <div class="skill-item">
                                    <div class="skill-check"><svg viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3"/></svg></div>
                                    Listening comprehension with fast-paced audio
                                </div>
                                <div class="skill-item">
                                    <div class="skill-check"><svg viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3"/></svg></div>
                                    Making predictions based on limited information
                                </div>
                                <div class="skill-item">
                                    <div class="skill-check"><svg viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3"/></svg></div>
                                    Describing past events and situations
                                </div>
                                <div class="skill-item">
                                    <div class="skill-check"><svg viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3"/></svg></div>
                                    Giving advice on technology-related problems
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lyrics Tab -->
                <div class="tab-content" id="lyrics">
                    <div class="warning-box">
                        <i class="fa-solid fa-triangle-exclamation"></i>
                        <div class="warning-box-content">
                            <h4>Before you continue:</h4> <p>Try to complete the listening exercises first. Only use the lyrics if you really need extra help.</p>
                        </div>
                    </div>
                    <div class="lyrics-container">
                        <div class="lyrics-header">
                            <h3>Get Off the Phone</h3>
                            <p>Rhett & Link</p>
                        </div>
                        <div class="lyrics-box">
                            <div class="lyrics-section">
                                <p class="lyrics-section-title">Intro</p>
                                <p class="lyrics-text">"Hey man, I've recently been doing some contemplation about people's dependency upon cellular telephones"
"Yeah man, me too. I've really noticed that everyone always seems to be on their mobile device instead of really being in the moment."
"Exactly, and I feel like this is a very significant issue that needs to be addressed immediately."
"Yes, immediately."
"We really should do something about this."</p>
                            </div>
                            <div class="lyrics-section">
                                <p class="lyrics-section-title">Verse 1</p>
                                <p class="lyrics-text">Here we have a man
Who's chosen to Instagram
His apple pie, a la mode.
While he fumbles through the filters
His ice cream has gotten "a la hot"
And the pie "a la cold."

As you can see
This street performer's drawn a crowd
To watch him do his thing.
But instead of just enjoying the show
it seems everyone's decided
To make a documentary.

Notice this unreasonably attractive couple
Enjoying a reasonably priced Italian dinner together.
Social networking instead of working
On getting to know each other better</p>
                            </div>
                            <div class="lyrics-section">
                                <p class="lyrics-section-title">Bridge 1</p>
                                <p class="lyrics-text">How does that filtered picture taste
Since your dessert has gone to waste?

When do you think you ever will
Wanna watch this portrait juggling film?

You know you want to touch each other
Doesn't that feel good?
"He's my brother."</p>
                            </div>
                            <div class="lyrics-section">
                                <p class="lyrics-section-title">Chorus</p>
                                <p class="lyrics-text">Get off the phone now!
It's gonna be okay
There's no need to be afraid.
(Get off the phone now!) It doesn't love you
It's gonna die one day.
The government is probably
Spying on you with it anyway.</p>
                            </div>
                            <div class="lyrics-section">
                                <p class="lyrics-section-title">Verse 2</p>
                                <p class="lyrics-text">Here we have a stereotypical teen
Forced to endure "Family Game Night."
He's stereotypically texting
And missing his mom
Demonstrate a carousel ride.

Little Ethan here
Is celebrating being the center of the universe
For one year.
But "The World's Greatest Dad"
Is more worried about 'Facebooking' it
Than actually being here.</p>
                            </div>
                            <div class="lyrics-section">
                                <p class="lyrics-section-title">Bridge 2</p>
                                <p class="lyrics-text">Let's listen in and see if we can get some context.
"Please hurry! We're at 382 Pine."
He has the nerve to make a phone call
At such a pivotal moment in his friend's life.

How could you be so disengaged?
While precious memories are being made?

Do you really think your friends need
Another baby picture in their feed?

Don't be such a self-centered guy.
Now isn't that better?
"I think he just died."</p>
                            </div>
                            <div class="lyrics-section">
                                <p class="lyrics-section-title">Chorus</p>
                                <p class="lyrics-text">Get off the phone now!
It's gonna be okay.
There's no need to be afraid.
(Get off the phone now!) It doesn't love you
It's gonna die one day.
It's crawling with e-coli bacteria anyway.
(Get off the phone now!) It's gonna be okay.</p>
                            </div>
                            <div class="lyrics-section">
                                <p class="lyrics-section-title">Outro</p>
                                <p class="lyrics-text">Hey guys, I'm on the set of a music video, uh, there's Rhett.
"Seriously?"
"What?"</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="activity-nav">
                    <button class="nav-btn nav-btn-back" id="btn-back" disabled>
                        <i class="fa-solid fa-arrow-left"></i> Back
                    </button>
                    <button class="nav-btn nav-btn-next" id="btn-next">
                        Next <i class="fa-solid fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </section>
    </main>

    <div id="footer-placeholder"></div>

    <script src="../../../js/layout.js"></script>
    <script src="../../../js/script.js" defer></script>
    <script src="../../../js/checkanswers.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const btnBack = document.getElementById('btn-back');
        const btnNext = document.getElementById('btn-next');

        // Initialize Custom Audio Player for Conversation
        new EnbreakAudioPlayer('conversation-player-container', '../../../assets/activities/get-off-the-phone/pre-listening.mp3');

        // True/False button functionality
        const tfBtns = document.querySelectorAll('.tf-btn');
        tfBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const parent = this.closest('.tf-item');
                const buttons = parent.querySelectorAll('.tf-btn');

                if (this.classList.contains('selected')) {
                    this.classList.remove('selected', 'correct', 'incorrect');
                } else {
                    buttons.forEach(b => {
                        b.classList.remove('selected', 'correct', 'incorrect');
                    });
                    this.classList.add('selected');
                }
            });
        });

        // Check True/False Answers
        const checkTfBtn = document.getElementById('check-tf');
        const retryTfBtn = document.getElementById('retry-tf');
        const tfList = document.getElementById('tf-list');

        if (checkTfBtn) {
            checkTfBtn.addEventListener('click', function() {
                const items = tfList.querySelectorAll('.tf-item');
                let correctCount = 0;
                let total = items.length;
                let allAnswered = true;

                items.forEach(item => {

                    const selectedBtn = item.querySelector('.tf-btn.selected');
                    const correctValue = item.dataset.correct;
                    const correctBtn = item.querySelector(`.tf-btn[data-value="${correctValue}"]`);

                    if (!selectedBtn) {
                        // No selection: mark correct answer to show what it was
                        return;
                    }

                    const userValue = selectedBtn.dataset.value;

                    if (userValue === correctValue) {
                        selectedBtn.classList.add('correct');
                        correctCount++;
                    } else {
                        selectedBtn.classList.add('incorrect');
                    }
                });

                showFeedbackPopup(correctCount, total);
                retryTfBtn.disabled = false;
            });
        }

        if (retryTfBtn) {
            retryTfBtn.addEventListener('click', function() {
                const items = tfList.querySelectorAll('.tf-item');
                items.forEach(item => {
                    const buttons = item.querySelectorAll('.tf-btn');
                    buttons.forEach(btn => {
                        btn.classList.remove('selected', 'correct', 'incorrect');
                        btn.disabled = false;
                    });
                });
                retryTfBtn.disabled = true;
                checkTfBtn.disabled = false;
            });
        }

        // Sentence Completion Exercise
        const checkSentencesBtn = document.getElementById('check-sentences');
        const retrySentencesBtn = document.getElementById('retry-sentences');
        const sentenceList = document.getElementById('sentence-completion-list');

        // Setup click handlers for choice options
        if (sentenceList) {
            sentenceList.addEventListener('click', function(e) {
                if (e.target.classList.contains('choice-option')) {
                    // Find parent group
                    const group = e.target.closest('.choice-group');
                    // Deselect siblings
                    group.querySelectorAll('.choice-option').forEach(opt => {
                        opt.classList.remove('selected', 'correct', 'incorrect');
                    });
                    // Select this
                    e.target.classList.add('selected');
                }
            });
        }

        if (checkSentencesBtn) {
            checkSentencesBtn.addEventListener('click', function() {
                const groups = sentenceList.querySelectorAll('.choice-group');
                let correctCount = 0;
                let total = groups.length;

                groups.forEach(group => {
                    const selected = group.querySelector('.choice-option.selected');
                    const correctAnswer = group.dataset.correct;
                    
                    if (selected) {
                        if (selected.textContent.trim() === correctAnswer) {
                            selected.classList.add('correct');
                            correctCount++;
                        } else {
                            selected.classList.add('incorrect');
                        }
                    }
                });

                showFeedbackPopup(correctCount, total);
                retrySentencesBtn.disabled = false;
            });
        }

        if (retrySentencesBtn) {
            retrySentencesBtn.addEventListener('click', function() {
                const options = sentenceList.querySelectorAll('.choice-option');
                options.forEach(opt => {
                    opt.classList.remove('selected', 'correct', 'incorrect');
                });
                retrySentencesBtn.disabled = true;
            });
        }

        // Matching Exercise (Post-Listening) - Line Connecting
        const canvas = document.getElementById('matching-canvas');
        const ctx = canvas ? canvas.getContext('2d') : null;
        const checkMatchingBtn = document.getElementById('check-matching');
        const retryMatchingBtn = document.getElementById('retry-matching');
        const problemItems = document.querySelectorAll('.problem-item');
        const adviceItems = document.querySelectorAll('.advice-item');

        let selectedProblem = null;
        let connections = [];

        function resizeCanvas() {
            if (!canvas) return;
            const container = canvas.parentElement;
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
            drawLines();
        }

        function getDotPosition(item) {
            const dot = item.querySelector('.matching-dot');
            const rect = dot.getBoundingClientRect();
            const containerRect = canvas.getBoundingClientRect();
            return {
                x: rect.left + rect.width / 2 - containerRect.left,
                y: rect.top + rect.height / 2 - containerRect.top
            };
        }

        function drawLines() {
            if (!ctx) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            connections.forEach(conn => {
                const problemEl = document.querySelector(`.problem-item[data-id="${conn.problem}"]`);
                const adviceEl = document.querySelector(`.advice-item[data-id="${conn.advice}"]`);

                if (problemEl && adviceEl) {
                    const start = getDotPosition(problemEl);
                    const end = getDotPosition(adviceEl);

                    ctx.beginPath();
                    ctx.moveTo(start.x, start.y);
                    ctx.lineTo(end.x, end.y);
                    ctx.strokeStyle = conn.correct !== undefined ?
                        (conn.correct ? '#16a34a' : '#dc2626') : '#0ea5e9';
                    ctx.lineWidth = 2.5;
                    ctx.lineCap = 'round';
                    ctx.stroke();
                }
            });
        }

        function removeConnection(problemId) {
            const connIndex = connections.findIndex(c => c.problem === problemId);
            if (connIndex !== -1) {
                const conn = connections[connIndex];
                const problemEl = document.querySelector(`.problem-item[data-id="${conn.problem}"]`);
                const adviceEl = document.querySelector(`.advice-item[data-id="${conn.advice}"]`);

                problemEl.classList.remove('matched');
                const adviceStillUsed = connections.some((c, i) => i !== connIndex && c.advice === conn.advice);
                if (!adviceStillUsed) {
                    adviceEl.classList.remove('matched');
                }

                connections.splice(connIndex, 1);
                drawLines();
            }
        }

        function updateMatchedStates() {
            adviceItems.forEach(advice => {
                const isUsed = connections.some(c => c.advice === advice.dataset.id);
                if (isUsed) {
                    advice.classList.add('matched');
                } else {
                    advice.classList.remove('matched');
                }
            });
        }

        problemItems.forEach(item => {
            item.addEventListener('click', function() {
                if (checkMatchingBtn.disabled) return;

                const problemId = this.dataset.id;
                const isMatched = this.classList.contains('matched');
                const isSelected = this.classList.contains('selected');

                if (isMatched) {
                    removeConnection(problemId);
                    return;
                }

                if (isSelected) {
                    this.classList.remove('selected');
                    selectedProblem = null;
                    return;
                }

                problemItems.forEach(p => p.classList.remove('selected'));
                this.classList.add('selected');
                selectedProblem = problemId;
            });
        });

        adviceItems.forEach(item => {
            item.addEventListener('click', function() {
                if (checkMatchingBtn.disabled) return;

                const adviceId = this.dataset.id;
                const isMatched = this.classList.contains('matched');

                if (isMatched && !selectedProblem) {
                    const connToRemove = connections.find(c => c.advice === adviceId);
                    if (connToRemove) {
                        removeConnection(connToRemove.problem);
                    }
                    return;
                }

                if (!selectedProblem) return;

                const existingProblemConn = connections.findIndex(c => c.problem === selectedProblem);
                if (existingProblemConn !== -1) {
                    connections.splice(existingProblemConn, 1);
                }

                connections.push({
                    problem: selectedProblem,
                    advice: adviceId
                });

                const problemEl = document.querySelector(`.problem-item[data-id="${selectedProblem}"]`);
                problemEl.classList.remove('selected');
                problemEl.classList.add('matched');

                updateMatchedStates();
                selectedProblem = null;
                drawLines();
            });
        });

        if (checkMatchingBtn) {
            checkMatchingBtn.addEventListener('click', function() {
                let correctCount = 0;

                problemItems.forEach(item => {
                    const problemId = item.dataset.id;
                    const correctAdviceId = item.dataset.correct;
                    const connection = connections.find(c => c.problem === problemId);

                    if (connection && connection.advice === correctAdviceId) {
                        connection.correct = true;
                        item.classList.add('correct');
                        const adviceEl = document.querySelector(`.advice-item[data-id="${connection.advice}"]`);
                        adviceEl.classList.add('correct');
                        correctCount++;
                    } else {
                        if (connection) {
                            connection.correct = false;
                            item.classList.add('incorrect');
                            const adviceEl = document.querySelector(`.advice-item[data-id="${connection.advice}"]`);
                            adviceEl.classList.add('incorrect');
                        }
                    }
                });

                drawLines();
                showFeedbackPopup(correctCount, problemItems.length);
                retryMatchingBtn.disabled = false;
                checkMatchingBtn.disabled = true;
            });
        }

        if (retryMatchingBtn) {
            retryMatchingBtn.addEventListener('click', function() {
                connections = [];
                problemItems.forEach(item => {
                    item.classList.remove('selected', 'matched', 'correct', 'incorrect');
                });
                adviceItems.forEach(item => {
                    item.classList.remove('matched', 'correct', 'incorrect');
                });
                drawLines();
                retryMatchingBtn.disabled = true;
                checkMatchingBtn.disabled = false;
            });
        }

        if (canvas) {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
        }

        // Vocabulary Matching - Drag and Drop
        const vocabWordsContainer = document.getElementById('vocab-words-container');
        const vocabPool = document.getElementById('vocab-pool');
        const dropZones = document.querySelectorAll('.vocab-drop-zone');
        let draggedElement = null;

        // Initial vocabulary data (shuffled)
        const vocabData = [
            { id: 'image-8', text: '"More worried about <strong>Facebooking</strong> it"' },
            { id: 'image-5', text: '"This unreasonably <strong>attractive couple</strong>"' },
            { id: 'image-3', text: '"The <strong>street performer</strong>"' },
            { id: 'image-4', text: '"A <strong>crowd</strong> to watch him do his thing"' },
            { id: 'image-2', text: '"His apple pie <strong>à la mode</strong>"' },
            { id: 'image-6', text: '"As he fumbles through the <strong>filters</strong>"' }
        ];

        // Function to create and render vocab words
        function renderVocabWords() {
            vocabWordsContainer.innerHTML = '';
            vocabData.forEach(vocab => {
                const word = document.createElement('div');
                word.className = 'vocab-word';
                word.draggable = true;
                word.dataset.imageId = vocab.id;
                word.innerHTML = vocab.text;
                vocabWordsContainer.appendChild(word);
            });
        }

        // Initial render
        renderVocabWords();

        // Function to add drag listeners to vocab words
        function addDragListeners() {
            const vocabWords = document.querySelectorAll('.vocab-word');
            vocabWords.forEach(word => {
                word.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                });

                word.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    draggedElement = null;
                });
            });

            // Add listeners to dropped words
            const droppedWords = document.querySelectorAll('.dropped-word');
            droppedWords.forEach(word => {
                word.draggable = true;
                word.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                });

                word.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    draggedElement = null;
                });
            });
        }

        // Initial drag listeners
        addDragListeners();

        // Vocab pool drop zone
        vocabPool.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            this.classList.add('drag-over');
        });

        vocabPool.addEventListener('dragleave', function(e) {
            this.classList.remove('drag-over');
        });

        vocabPool.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('drag-over');

            if (draggedElement && draggedElement.classList.contains('dropped-word')) {
                // Moving a word back to the pool
                const imageId = draggedElement.dataset.imageId;
                const parentZone = draggedElement.parentElement;
                
                // Add word back to pool
                const newWord = document.createElement('div');
                newWord.className = 'vocab-word';
                newWord.draggable = true;
                newWord.dataset.imageId = imageId;
                newWord.innerHTML = draggedElement.innerHTML;
                vocabWordsContainer.appendChild(newWord);

                // Clear the drop zone
                if (parentZone) {
                    parentZone.innerHTML = '';
                }

                addDragListeners();
            }
        });

        // Image drop zones
        dropZones.forEach(zone => {
            zone.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            });

            zone.addEventListener('dragleave', function(e) {
                this.classList.remove('drag-over');
            });

            zone.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');

                if (draggedElement) {
                    const correctImageId = draggedElement.dataset.imageId;
                    const targetImageId = this.dataset.imageId;

                    // Check if there's already a word in this zone
                    const existingWord = this.querySelector('.dropped-word');
                    
                    if (draggedElement.classList.contains('vocab-word')) {
                        // Dragging from pool to zone
                        if (existingWord) {
                            // Swap: move existing word back to pool
                            const existingImageId = existingWord.dataset.imageId;
                            const newWord = document.createElement('div');
                            newWord.className = 'vocab-word';
                            newWord.draggable = true;
                            newWord.dataset.imageId = existingImageId;
                            newWord.innerHTML = existingWord.innerHTML;
                            vocabWordsContainer.appendChild(newWord);
                        }

                        // Remove from pool and add to zone
                        draggedElement.remove();
                        this.innerHTML = '';

                        const droppedWord = document.createElement('div');
                        droppedWord.className = 'dropped-word';
                        droppedWord.innerHTML = draggedElement.innerHTML;
                        droppedWord.dataset.imageId = correctImageId;
                        this.appendChild(droppedWord);

                        addDragListeners();
                    } else if (draggedElement.classList.contains('dropped-word')) {
                        // Dragging from zone to zone (swap)
                        const draggedFromZone = draggedElement.parentElement;
                        const draggedImageId = draggedElement.dataset.imageId;
                        
                        if (existingWord) {
                            // Both zones have words - swap them
                            draggedFromZone.innerHTML = '';
                            draggedFromZone.appendChild(existingWord);
                        } else {
                            // Target zone is empty - just move
                            draggedFromZone.innerHTML = '';
                        }

                        this.innerHTML = '';
                        this.appendChild(draggedElement);
                        addDragListeners();
                    }
                }
            });
        });

        // Right-click context menu for dropped words (using event delegation)
        document.addEventListener('contextmenu', function(e) {
            let droppedWord = e.target.closest('.dropped-word');
            if (droppedWord) {
                e.preventDefault();
                const imageId = droppedWord.dataset.imageId;
                const parentZone = droppedWord.parentElement;
                
                // Add word back to pool
                const newWord = document.createElement('div');
                newWord.className = 'vocab-word';
                newWord.draggable = true;
                newWord.dataset.imageId = imageId;
                newWord.innerHTML = droppedWord.innerHTML;
                vocabWordsContainer.appendChild(newWord);

                // Clear the drop zone
                if (parentZone) {
                    parentZone.innerHTML = '';
                }

                addDragListeners();
            }
        });

        // Check Vocabulary Matching Answers
        const checkVocabMatchingBtn = document.getElementById('check-vocab-matching');
        const retryVocabMatchingBtn = document.getElementById('retry-vocab-matching');
        const vocabMatchingFeedback = document.getElementById('vocab-matching-feedback');

        if (checkVocabMatchingBtn) {
            checkVocabMatchingBtn.addEventListener('click', function() {
                let correct = 0;
                let total = 6;

                dropZones.forEach(zone => {
                    const droppedWord = zone.querySelector('.dropped-word');
                    if (droppedWord) {
                        const correctImageId = droppedWord.dataset.imageId;
                        const zoneImageId = zone.dataset.imageId;

                        if (correctImageId === zoneImageId) {
                            correct++;
                            zone.classList.remove('incorrect-match');
                            zone.classList.add('correct-match');
                        } else {
                            zone.classList.remove('correct-match');
                            zone.classList.add('incorrect-match');
                        }
                    } else {
                        zone.classList.remove('correct-match', 'incorrect-match');
                    }
                });

                showFeedbackPopup(correct, total);
                retryVocabMatchingBtn.disabled = false;
            });
        }

        if (retryVocabMatchingBtn) {
            retryVocabMatchingBtn.addEventListener('click', function() {
                // Clear all words from drop zones and return to pool
                dropZones.forEach(zone => {
                    const droppedWord = zone.querySelector('.dropped-word');
                    if (droppedWord) {
                        droppedWord.remove();
                    }
                    zone.classList.remove('correct-match', 'incorrect-match');
                });

                // Reset the word pool with all words
                vocabWordsContainer.innerHTML = '';
                const vocabWords = [
                    { id: 'image-2', text: '"His apple pie <strong>à la mode</strong>"' },
                    { id: 'image-4', text: '"The <strong>crowd</strong> just held their phones up"' },
                    { id: 'image-3', text: '"The <strong>street performer</strong> is there"' },
                    { id: 'image-1', text: '"Their <strong>lunch</strong> out on the deck"' },
                    { id: 'image-5', text: '"<strong>Attractive couple</strong> on the subway"' },
                    { id: 'image-6', text: '"<strong>Get off</strong> the phone"' }
                ];

                vocabWords.forEach(word => {
                    const wordDiv = document.createElement('div');
                    wordDiv.className = 'vocab-word';
                    wordDiv.draggable = true;
                    wordDiv.dataset.imageId = word.id;
                    wordDiv.innerHTML = word.text;
                    vocabWordsContainer.appendChild(wordDiv);
                });

                addDragListeners();
                retryVocabMatchingBtn.disabled = true;
            });
        }

        // Prediction Exercise - Checkboxes
        const predictionChecklist = document.getElementById('prediction-checklist');
        const checkPredictionsBtn = document.getElementById('check-predictions');
        const retryPredictionsBtn = document.getElementById('retry-predictions');
        const predictionFeedback = document.getElementById('prediction-feedback');

        if (predictionChecklist) {
            const predictionItems = predictionChecklist.querySelectorAll('.prediction-item');
            predictionItems.forEach(item => {
                item.addEventListener('click', function() {
                    this.classList.toggle('selected');
                    this.classList.remove('correct', 'incorrect');
                });
            });
        }

        if (checkPredictionsBtn) {
            checkPredictionsBtn.addEventListener('click', function() {
                const predictionItems = predictionChecklist.querySelectorAll('.prediction-item');
                let incorrectSelections = 0;
                let totalCorrectAnswers = 3;
                let userCorrectCount = 0;

                predictionItems.forEach(item => {
                    const isSelected = item.classList.contains('selected');
                    const isCorrectAnswer = item.dataset.correct === 'true';

                    if (isSelected) {
                        if (isCorrectAnswer) {
                            item.classList.add('correct');
                            userCorrectCount++;
                        } else {
                            item.classList.add('incorrect');
                            incorrectSelections++;
                        }
                    } else {
                        item.classList.remove('correct', 'incorrect');
                    }
                });

                // Disable further selections
                retryPredictionsBtn.disabled = false;

                // Show feedback
                const score = userCorrectCount - incorrectSelections;
                const finalScore = Math.max(0, score);

                showFeedbackPopup(finalScore, totalCorrectAnswers);
            });
        }

        if (retryPredictionsBtn) {
            retryPredictionsBtn.addEventListener('click', function() {
                const predictionItems = predictionChecklist.querySelectorAll('.prediction-item');
                predictionItems.forEach(item => {
                    item.classList.remove('selected', 'correct', 'incorrect');
                });
                checkPredictionsBtn.disabled = false;
                retryPredictionsBtn.disabled = true;
            });
        }

        // Conversation Exercise - Drag and Drop
        const conversationWordsContainer = document.getElementById('conversation-words-container');
        const conversationVocabPool = document.getElementById('conversation-vocab-pool');
        const conversationGaps = document.querySelectorAll('.conversation-gap');
        let draggedConversationElement = null;

        function addConversationDragListeners() {
            const conversationWords = document.querySelectorAll('.conversation-word');
            conversationWords.forEach(word => {
                word.addEventListener('dragstart', function(e) {
                    draggedConversationElement = this;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                });

                word.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    draggedConversationElement = null;
                });
            });

            // Add listeners to dropped conversation words
            const droppedWords = document.querySelectorAll('.dropped-conversation-word');
            droppedWords.forEach(word => {
                word.draggable = true;
                word.addEventListener('dragstart', function(e) {
                    draggedConversationElement = this;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                });

                word.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    draggedConversationElement = null;
                });
            });
        }

        // Initial conversation drag listeners
        addConversationDragListeners();

        // Conversation vocab pool drop zone
        conversationVocabPool.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            this.classList.add('drag-over');
        });

        conversationVocabPool.addEventListener('dragleave', function(e) {
            this.classList.remove('drag-over');
        });

        conversationVocabPool.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('drag-over');

            if (draggedConversationElement && draggedConversationElement.classList.contains('dropped-conversation-word')) {
                // Moving a word back to the pool
                const wordId = draggedConversationElement.dataset.wordId;
                const parentGap = draggedConversationElement.parentElement;

                // Add word back to pool
                const newWord = document.createElement('div');
                newWord.className = 'conversation-word';
                newWord.draggable = true;
                newWord.dataset.wordId = wordId;
                newWord.textContent = draggedConversationElement.textContent;
                conversationWordsContainer.appendChild(newWord);

                // Clear the gap
                if (parentGap) {
                    parentGap.innerHTML = '';
                }

                addConversationDragListeners();
            }
        });

        // Conversation gaps
        conversationGaps.forEach(gap => {
            gap.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            });

            gap.addEventListener('dragleave', function(e) {
                this.classList.remove('drag-over');
            });

            gap.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');

                if (draggedConversationElement) {
                    const wordId = draggedConversationElement.dataset.wordId;

                    // Check if there's already a word in this gap
                    const existingWord = this.querySelector('.dropped-conversation-word');

                    if (draggedConversationElement.classList.contains('conversation-word')) {
                        // Dragging from pool to gap
                        if (existingWord) {
                            // Swap: move existing word back to pool
                            const existingWordId = existingWord.dataset.wordId;
                            const newWord = document.createElement('div');
                            newWord.className = 'conversation-word';
                            newWord.draggable = true;
                            newWord.dataset.wordId = existingWordId;
                            newWord.textContent = existingWord.textContent;
                            conversationWordsContainer.appendChild(newWord);
                        }

                        // Remove from pool and add to gap
                        draggedConversationElement.remove();
                        this.innerHTML = '';

                        const droppedWord = document.createElement('span');
                        droppedWord.className = 'dropped-conversation-word';
                        droppedWord.textContent = draggedConversationElement.textContent;
                        droppedWord.dataset.wordId = wordId;
                        this.appendChild(droppedWord);

                        addConversationDragListeners();
                    } else if (draggedConversationElement.classList.contains('dropped-conversation-word')) {
                        // Dragging from gap to gap (swap)
                        const draggedFromGap = draggedConversationElement.parentElement;

                        if (existingWord) {
                            // Both gaps have words - swap them
                            draggedFromGap.innerHTML = '';
                            draggedFromGap.appendChild(existingWord);
                        } else {
                            // Target gap is empty - just move
                            draggedFromGap.innerHTML = '';
                        }

                        this.innerHTML = '';
                        this.appendChild(draggedConversationElement);
                        addConversationDragListeners();
                    }
                }
            });
        });

        // Right-click to return conversation word to pool
        document.addEventListener('contextmenu', function(e) {
            let droppedWord = e.target.closest('.dropped-conversation-word');
            if (droppedWord) {
                e.preventDefault();
                const wordId = droppedWord.dataset.wordId;
                const parentGap = droppedWord.parentElement;

                // Add word back to pool
                const newWord = document.createElement('div');
                newWord.className = 'conversation-word';
                newWord.draggable = true;
                newWord.dataset.wordId = wordId;
                newWord.textContent = droppedWord.textContent;
                conversationWordsContainer.appendChild(newWord);

                // Clear the gap
                if (parentGap) {
                    parentGap.innerHTML = '';
                }

                addConversationDragListeners();
            }
        });

        // Check Conversation Answers
        const checkConversationBtn = document.getElementById('check-conversation');
        const retryConversationBtn = document.getElementById('retry-conversation');
        const conversationFeedback = document.getElementById('conversation-feedback');

        if (checkConversationBtn) {
            checkConversationBtn.addEventListener('click', function() {
                let correct = 0;
                let total = 7;

                conversationGaps.forEach(gap => {
                    const droppedWord = gap.querySelector('.dropped-conversation-word');
                    if (droppedWord) {
                        const correctWordId = gap.dataset.wordId;
                        const placedWordId = droppedWord.dataset.wordId;

                        if (correctWordId === placedWordId) {
                            correct++;
                            gap.classList.remove('incorrect-gap');
                            gap.classList.add('correct-gap');
                        } else {
                            gap.classList.remove('correct-gap');
                            gap.classList.add('incorrect-gap');
                        }
                    } else {
                        gap.classList.remove('correct-gap', 'incorrect-gap');
                    }
                });

                showFeedbackPopup(correct, total);
                retryConversationBtn.disabled = false;
            });
        }

        if (retryConversationBtn) {
            retryConversationBtn.addEventListener('click', function() {
                // Clear all words from gaps and return to pool
                conversationGaps.forEach(gap => {
                    const droppedWord = gap.querySelector('.dropped-conversation-word');
                    if (droppedWord) {
                        droppedWord.remove();
                    }
                    gap.classList.remove('correct-gap', 'incorrect-gap');
                });

                // Reset the word pool with all words in original order
                conversationWordsContainer.innerHTML = '';
                const words = ['noticed', 'should', 'dependency', 'addressed', 'contemplation', 'instead', 'issue'];
                words.forEach(wordId => {
                    const wordDiv = document.createElement('div');
                    wordDiv.className = 'conversation-word';
                    wordDiv.draggable = true;
                    wordDiv.dataset.wordId = wordId;
                    wordDiv.textContent = wordId;
                    conversationWordsContainer.appendChild(wordDiv);
                });

                addConversationDragListeners();
                retryConversationBtn.disabled = true;
            });
        }

        // Main Idea Exercise - Listening Tab
        const mainIdeaChecklist = document.getElementById('main-idea-checklist');
        const checkMainIdeaBtn = document.getElementById('check-main-idea');
        const retryMainIdeaBtn = document.getElementById('retry-main-idea');

        if (mainIdeaChecklist) {
            const mainIdeaItems = mainIdeaChecklist.querySelectorAll('.prediction-item');
            mainIdeaItems.forEach(item => {
                item.addEventListener('click', function() {
                    const wasSelected = this.classList.contains('selected');
                    // Allow only one selection
                    mainIdeaItems.forEach(i => i.classList.remove('selected', 'correct', 'incorrect'));
                    if (!wasSelected) {
                        this.classList.add('selected');
                    }
                });
            });
        }

        if (checkMainIdeaBtn) {
            checkMainIdeaBtn.addEventListener('click', function() {
                const selectedItem = mainIdeaChecklist.querySelector('.prediction-item.selected');
                
                if (selectedItem) {
                    const isCorrect = selectedItem.dataset.correct === 'true';
                    if (isCorrect) {
                        selectedItem.classList.add('correct');
                        showFeedbackPopup(1, 1);
                    } else {
                        selectedItem.classList.add('incorrect');
                        showFeedbackPopup(0, 1);
                    }
                } else {
                    showFeedbackPopup(0, 1);
                }

                retryMainIdeaBtn.disabled = false;
            });
        }

        if (retryMainIdeaBtn) {
            retryMainIdeaBtn.addEventListener('click', function() {
                const mainIdeaItems = mainIdeaChecklist.querySelectorAll('.prediction-item');
                mainIdeaItems.forEach(item => {
                    item.classList.remove('selected', 'correct', 'incorrect');
                });
                retryMainIdeaBtn.disabled = true;
            });
        }

        updateNavButtons();
    });


    </script>
</body>
</html>
